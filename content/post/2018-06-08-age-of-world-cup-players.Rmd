---
title: Age of World Cup Players
author: Michael Pawlus
date: '2018-06-08'
slug: age-of-world-cup-players
categories:
  - rstats
tags:
  - Soccer
---

# Age of World Cup Players

This is post two in a series using data for all World Cup teams collected in the [first post](https://michaelpawlus.netlify.com/2018/06/05/all-world-cup-squads/)

Here we will do a few visualizations around age.

### Setup

```{r message=FALSE, warning=FALSE}
# load libraries  
library(tidyverse) # for data manipulation
library(lubridate) # to work with the birthdates
library(knitr) # for tables
library(plotly) # for interactive plots

# load data
all_squads <- read_csv("https://raw.githubusercontent.com/joemgon/worldcup2018/master/squads.csv")
```

### How has the age of players changed over time?

```{r warning=FALSE}
# age of players by year
ggplot(all_squads, aes(x=Year, y=age)) +
  geom_jitter(alpha=0.2, color="#171714") +
  stat_summary(fun.y=mean, geom="line", size=1, color="#D30208") +
  stat_summary(fun.y=median, geom="line", size=1, color="#E5C685") +
  # note on mean line
  annotate("rect", xmin = 1928, xmax = 1932, ymin = 41, ymax = 43,
          color = "#D30208", fill = "#D30208") +
  annotate("text", x = 1934, y = 42, label = "average age", color="#171714", hjust = 0, size = 4) +
  # note on median line
  annotate("rect", xmin = 1928, xmax = 1932, ymin = 37, ymax = 39,
           color = "#E5C685", fill = "#E5C685") +
  annotate("text", x = 1934, y = 38, label = "median age", color="#171714", hjust = 0, size = 4) +
  theme(panel.background = element_blank(), 
        panel.grid.major.y = element_line(color = "#171714", size = 0.25), 
        legend.position="none",
        plot.title = element_text(hjust = 0.5)) + 
  labs(x = "Year", y = "Age", title = "Age of World Cup Players")
```

The ages of players have not changed much but there does seem to be an increase in the the number of players in their mid-30s.

```{r}
## players 35+
all_squads %>%
  filter(age > 34) %>%
  group_by(Year) %>%
  summarize(`Players 35 and older` = n_distinct(Player)) %>%
  ungroup() %>%
  arrange(desc(Year)) %>%
  kable()
```

Here is one attempt to see the player ages for all 2018 teams with additional details when you hover on the points. However, since this done with points therw will be overlaps where only one detail record is shown.

```{r}
# make a subset of the data for 2018
wc18_age <- all_squads %>%
  filter(Year == 2018) %>%
  mutate(Country = fct_reorder(Country, desc(Country)), Pos = str_extract(Pos,"[:alpha:]+"))

# create a scatterplot with ggplot
wc18_age_plot <- ggplot(wc18_age, aes(Country, age)) +
  geom_point(color = "#015386") + 
  coord_flip() +
  theme(text = element_text(color = "#171714"),
        panel.background = element_blank(), 
        panel.grid.major.x = element_line(color = "#171714", size = 0.15), 
        legend.position="none",
        plot.title = element_text(hjust = 0.5)) +
  labs(title = "Ages for World Cup 2018 Teams")

# convert to plotly
wc18_age_plot <- ggplotly(wc18_age_plot)

# change the details provided when hovering over points
text_vec <- paste0("Country: ",wc18_age$Country,"<br />Name: ",wc18_age$Player,"<br />Position: ",wc18_age$Pos,"<br />Age: ",wc18_age$age)

wc18_age_plot$x$data[1][[1]][[3]] <- text_vec

# view the plot
wc18_age_plot
```